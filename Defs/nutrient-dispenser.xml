<?xml version="1.0" encoding="utf-8" ?>
<Defs>
    <!--Based (mostly) off of BiofuelRefinery, which basically means it's like other benches / stoves.-->
    <ThingDef Name="NutrientPasteDispenser" ParentName="BenchBase">
        <defName>NutrientPasteDispenser</defName>  <!--Oops. This should probably be patched, rather than just re-use the same name...-->
        <label>nutrient dispenser</label>
        <description>A machine that processes raw foodstuffs into non-poisonous, wholly edible products. It uses less time and ingredients than cooking a meal by hand, but nobody likes eating this stuff. On top of that, the machine looks like a freak combination of gears, pipes, and random junk, emits horrid noises, and smells; You don't want to stick around this machine unless you absolutely have to.</description>

        <!--Visuals-->
        <graphicData>
            <texPath>Things/Building/Production/Refinery</texPath>
            <graphicClass>Graphic_Multi</graphicClass>
            <shaderType>CutoutComplex</shaderType>
            <drawSize>(3,2)</drawSize>
            <shadowData>
                <volume>(2.22, 0.8, 0.62)</volume>
                <offset>(0, 0, -0.13)</offset>
            </shadowData>
            <damageData>
                <rect>(0.3,0.1,2.4,1.8)</rect>
            </damageData>
        </graphicData>
        <size>(3,2)</size>
        <castEdgeShadows>false</castEdgeShadows>
        <staticSunShadowHeight>0</staticSunShadowHeight>
        <altitudeLayer>Building</altitudeLayer> <!--I think this affects what gets drawn on top or underneath.-->

        <!--Construction costs, prereqs, etc-->
        <statBases>
            <MaxHitPoints>400</MaxHitPoints>
            <WorkToBuild>2500</WorkToBuild>
            <Flammability>0.5</Flammability>
            <Beauty>-300</Beauty>
            <Mass>200</Mass>
        </statBases>
        <constructionSkillPrerequisite>5</constructionSkillPrerequisite>
        <costList>
            <Steel>300</Steel>
            <ComponentIndustrial>3</ComponentIndustrial>
        </costList>
        <terrainAffordanceNeeded>Heavy</terrainAffordanceNeeded>
        <designationCategory>Production</designationCategory> <!--What menu it shows up in, to construct.-->
        <researchPrerequisites>
            <li>NutrientPaste</li>
        </researchPrerequisites>

        <!--How it functions-->
        <thingClass>Building_WorkTable</thingClass>
        <passability>PassThroughOnly</passability>
        <pathCost>70</pathCost>
        <comps>
            <li Class="CompProperties_Power">
                <compClass>CompPowerTrader</compClass>
                <basePowerConsumption>250</basePowerConsumption>
                <shortCircuitInRain>true</shortCircuitInRain>
            </li>
            <li Class="CompProperties_Flickable"/>
            <li Class="CompProperties_Breakdownable"/>
            <li Class="CompProperties_Glower">
                <glowRadius>3</glowRadius>
                <glowColor>(0,255,0,0)</glowColor>
            </li>
        </comps>
        <recipes>
            <li>MakeNutrientPaste</li>
            <li>MakeNutrientBrick</li>
            <li>MakeNutrientPasteBulk</li>
            <li>MakeNutrientBrickBulk</li>
        </recipes>
        <inspectorTabs>
            <li>ITab_Bills</li>
        </inspectorTabs>
        <building>
            <isMealSource>true</isMealSource>
            <spawnedConceptLearnOpportunity>BillsTab</spawnedConceptLearnOpportunity>
        </building>
        <fillPercent>0.4</fillPercent> <!--combat cover effectiveness %-->
        <hasInteractionCell>true</hasInteractionCell>
        <interactionCellOffset>(0,0,-1)</interactionCellOffset>
        <interactionCellIcon>Stool</interactionCellIcon>
        <surfaceType>Item</surfaceType>
    </ThingDef>

    <!--Make the dispenser actuallly interactible-->
    <WorkGiverDef>
        <defName>DoBillsEtDispenseNutrientPaste</defName>
        <label>dispense nutrients</label>
        <giverClass>WorkGiver_DoBill</giverClass>
        <workType>BasicWorker</workType>
        <priorityInType>95</priorityInType>
        <fixedBillGiverDefs>
            <li>NutrientPasteDispenser</li>
        </fixedBillGiverDefs>
        <verb>extrude</verb>
        <gerund>extruding at</gerund>
        <requiredCapacities>
            <li>Manipulation</li>
        </requiredCapacities>
        <prioritizeSustains>true</prioritizeSustains>
    </WorkGiverDef>


    <!--Recipes-->
    <RecipeDef Name="MakeNutrientBase" Abstract="True">
        <defName>MakeNutrientBase</defName>
        <workSpeedStat>UnskilledLaborSpeed</workSpeedStat>
        <effectWorking>Cook</effectWorking>
        <soundWorking>Recipe_CookMeal</soundWorking>
        <allowMixingIngredients>true</allowMixingIngredients>
        <ingredientValueGetterClass>IngredientValueGetter_Nutrition</ingredientValueGetterClass>
        <fixedIngredientFilter>
            <categories>
                <li>FoodRaw</li>
            </categories>

            <!--Don't need to disable hay anymore...?-->
            <!--<disallowedSpecialFilters>-->
                <!--<li>AllowPlantFood</li>-->
            <!--</disallowedSpecialFilters>-->
        </fixedIngredientFilter>
        <defaultIngredientFilter>
            <categories>
                <li>FoodRaw</li>
            </categories>
            <disallowedCategories>
                <li>EggsFertilized</li>
            </disallowedCategories>
            <disallowedThingDefs>
                <li>Meat_Human</li>
                <li>Meat_Megaspider</li>
                <li>InsectJelly</li>
            </disallowedThingDefs>
        </defaultIngredientFilter>
        <workSkill>Crafting</workSkill> <!-- If this is left blank, it seems to allow any pawn to work the recipe, regardless of work-restriction. Given the description of "crafting" i nthe base game, it's meant to represent general-purpose labour, that's slightly more skilled than just sweeping. Setting this also makes the recipe give experience points for the skill. (Not sure how to override how much / any.) This is OK, I guess, since you could watch the machine better / make sure it doesn't break down? -->
    </RecipeDef>

    <RecipeDef Name="MakeNutrientPaste" ParentName="MakeNutrientBase">
        <defName>MakeNutrientPaste</defName>
        <label>nutrient paste</label>
        <description>Extrude some nutrient paste.</description>
        <jobString>Extruding nutrient paste.</jobString>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>FoodRaw</li>
                    </categories>
                </filter>
                <count>0.3</count>
            </li>
        </ingredients>
        <products>
            <MealNutrientPaste>1</MealNutrientPaste>
        </products>
        <workAmount>100</workAmount>
    </RecipeDef>

    <RecipeDef Name="MakeNutrientPasteBulk" ParentName="MakeNutrientBase">
        <defName>MakeNutrientPasteBulk</defName>
        <label>nutrient paste (bulk)</label>
        <description>Extrude a batch of nutrient paste.</description>
        <jobString>Extruding nutrient paste.</jobString>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>FoodRaw</li>
                    </categories>
                </filter>
                <count>3</count>
            </li>
        </ingredients>
        <products>
            <MealNutrientPaste>10</MealNutrientPaste>
        </products>
        <workAmount>900</workAmount>
    </RecipeDef>

    <RecipeDef Name="MakeNutrientBrick" ParentName="MakeNutrientBase">
        <defName>MakeNutrientBrick</defName>
        <label>nutrient brick</label>
        <description>Extrude a nutrient brick.</description>
        <jobString>Extruding a nutrient brick.</jobString>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>FoodRaw</li>
                    </categories>
                </filter>
                <count>0.35</count>
            </li>
        </ingredients>
        <products>
            <MealNutrientBrick>1</MealNutrientBrick>
        </products>
        <workAmount>400</workAmount> <!-- packaged survival meal is 450 -->
    </RecipeDef>

    <RecipeDef Name="MakeNutrientBrickBulk" ParentName="MakeNutrientBase">
        <defName>MakeNutrientBrickBulk</defName>
        <label>nutrient brick (bulk)</label>
        <description>Extrude a batch of nutrient bricks.</description>
        <jobString>Extruding nutrient bricks.</jobString>
        <ingredients>
            <li>
                <filter>
                    <categories>
                        <li>FoodRaw</li>
                    </categories>
                </filter>
                <count>3.5</count>
            </li>
        </ingredients>
        <products>
            <MealNutrientBrick>10</MealNutrientBrick>
        </products>
        <workAmount>3500</workAmount>
    </RecipeDef>
</Defs>
